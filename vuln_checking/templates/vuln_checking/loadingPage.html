{% extends "collectionmanagement/base.html" %}
{%load static%}
{%block content%}
<!--<h1>Result of scan : {{scanName}}</h1>
<h2>On API collection : {{apiCollection.name}}</h2>
<ul>
    {% for endpoint in checkedEndpoints %}
        <li>{{ endpoint.name }}</li>
    {% endfor %}
</ul>-->

<div class="container mt-5">
    <div class="text-center">
        <h3>Veuillez patienter pendant le chargement de la page...</h3>
        <div class="progress mt-4" style="height: 30px;">
            <div id="progress-bar" class="progress-bar" role="progressbar" style="width: 0%;" aria-valuenow="0" aria-valuemin="0" aria-valuemax="100">0%</div>
        </div>
    </div>
</div>
<script src="https://code.jquery.com/jquery-3.5.1.min.js"></script>
<script>
    $(document).ready(function() {
        function updateProgressBar(percentage) {
            $("#progress-bar").css("width", percentage + "%").attr("aria-valuenow", percentage).text(percentage + "%");
        }

        $.ajax({
            url: '{% url "perform_operations" %}',
            method: 'GET',
            success: function(data) {
                data.forEach(function(step) {
                    setTimeout(function() {
                        updateProgressBar(step.percentage);
                    }, step.step * 2000);  // Ajuster le délai en fonction de vos besoins
                });
                
                // Rediriger après la dernière étape
                setTimeout(function() {
                    window.location.href = "/";
                }, data.length * 2000);
            }
        });
    });
</script>

{%endblock%}