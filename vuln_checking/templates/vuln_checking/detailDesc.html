{% extends "collectionmanagement/base.html" %}
{%load static%}
{%block content%}
<style>
    .table td, .table select, .table input {
            background-color: inherit;
            border: none;
        }
</style>
<p class="h3">Detailed result of scan <small class="text-muted">{{scan_name}}</small> on endpoint : <small class="text-muted">{{endpoint}}</small></p>

<div class="row mt-3">
   Choose a security checkpoint : 
   <select id="my_select" class="form-select  ml-4" aria-label="Default select example">
        <option selected>Select Checkpoint</option>
        {%for checkpoint in checkpoints%}
           <option value="{{checkpoint.id}}">{{checkpoint.Name}}</option>
        {%endfor%}
  </select>
</div>

<div class="container mt-4">
    <table class="table table-bordered table-secondary">
        <thead class="table-light text-center">
            <tr>
                <th>Status</th>
                <th>Confidentiality Impact</th>
                <th>Integrity Impact</th>
                <th>Availability Impact</th>
            </tr>
        </thead>
        <tbody>
            <tr>
                <td>
                    <select class="form-select w-100" aria-label="Default select example" style="width:max-content;">
                        <option selected>YES</option>
                        <option>NO</option>
                        <option>NOT</option>
                    </select>
                </td>
                <td>
                    <input type="text" id="C_impact" value="" class="text-center w-100">
                </td>
                <td>
                    <input type="text" id="I_impact" value="" class="text-center w-100">
                </td>
                <td>
                    <input type="text" id="A_impact" value="" class="text-center w-100">
                </td>
            </tr>
        </tbody>
    </table>
</div>


<div class="overflow-auto mt-3" style="height: 500px;">
    <div class="row">
      <div class="col-md-6  card stretch-card">
        <div class="card-body">
            <h4 class="card-title mb-1">Base Request</h4> 
              <div class="form-floating">
              <textarea id="baseRequest" name="header" style="height: 250px;width:100%;box-sizing: border-box;text-align: left;" 
              rows="10"></textarea>
            </div>
        </div>
      </div>
      
      <div class="col-md-6  card stretch-card">
        <div class="card-body">
            <h4 class="card-title mb-1">Base Response</h4> 
              <div class="form-floating">
              <textarea id="baseResponse" name="body" style="height: 250px;width:100%;box-sizing: border-box;text-align: left;" 
              rows="10"></textarea>
            </div>
        </div>
      </div>
  
    </div>

    <div class="row">
        <div class="col-md-6  card stretch-card">
          <div class="card-body">
              <h4 class="card-title mb-1">Modified Request</h4> 
                <div class="form-floating">
                <textarea id="modifiedRequest" name="header" style="height: 250px;width:100%;box-sizing: border-box;text-align: left;" 
                rows="10"></textarea>
              </div>
          </div>
        </div>
        
        <div class="col-md-6  card stretch-card">
          <div class="card-body">
              <h4 class="card-title mb-1">Modified Response</h4> 
                <div class="form-floating">
                <textarea id="modifiedResponse" name="body" style="height: 250px;width:100%;box-sizing: border-box;text-align: left;" 
                rows="10"></textarea>
              </div>
          </div>
        </div>
    
      </div>
</div>

<script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
    <script>
        $(document).ready(function() {
            $('#my_select').change(function() {
                var selectedValue = $(this).val();
                var endpoint = '{{endpoint.id}}'
                if (selectedValue) {
                    $.ajax({
                        url: "{% url 'get_values' %}",
                        data: {
                            'checkpoint': selectedValue,
                            'endpoint': endpoint
                        },
                        dataType: 'json',
                        success: function(data) {
                            $('#modifiedResponse').val(data.modifiedResponse);
                            $('#modifiedRequest').val(data.modifiedRequest);
                            $('#baseRequest').val(data.baseRequest);
                            $('#baseResponse').val(data.baseResponse);
                        },
                        error: function() {
                            $('#textarea-element-1').val('');
                            $('#textarea-element-2').val('');
                        }
                    });
                } else {
                    $('#textarea-element-1').val('');
                    $('#textarea-element-2').val('');
                }
            });
        });
    </script>

{%endblock%}