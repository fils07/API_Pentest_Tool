{% extends "collectionmanagement/base.html" %}
{%load static%}
{%block content%}

<form method="post" action="{% url 'result'%}">
 {%csrf_token%}
<div class="row">
<label for="selectAPI" class="col-md-2 mt-2">Select API</label>
<select id="selectAPI" class="col-md-6" name="selectAPI">
    <option selected>Select an api collection</option>
    {% for api in collections %}
    <option value="{{api.id}}">{{api.name}}</option>
    {%endfor%}
</select>
</div>

<span>Select endpoints : </span>
<div class="row mt-3" id="endpoints-container">
</div>

<div class="row m-3">
    <button type="button" id="select-all" class="btn btn-primary">Select All</button>
    <button type="button" id="deselect-all" class="btn btn-secondary ml-2">Deselect All</button>
</div>

<div class="row overflow-auto" style="height: 300px;">
    <ul class="list-group col-md-12" style="color: black;">
        {% for v in vulnerability %}
        <li class="list-group-item" aria-expanded="false" aria-controls="ui-basic">
            <div class="row">
               <a data-toggle="collapse" href="#api{{v.id}}" class="text-black-50">{{v.Name}}</a>
               <a class="ml-2" href="{%url 'vulnDesc' v.id%}" target="_blank"><img src="{% static 'images/icons8-new-tab.svg' %}" width="15px" height="15px"></a>
            </div>
         <ul class="list-group col-md-12 collapse ml-2" id="api{{v.id}}">
            <li class="list-group-item" style="background-color: gray;">
                <div class="row form-check-inline">
                 <input type="checkbox" checked value="ch1" id="ch1" class="form-check-input" name="checkpoint-1">
                 <label for='ch1' class="form-check-label">Checkpoint 1</label>
                 <a class="ml-2" href="{%url 'checkDesc' 1%}" target="_blank"><img src="{% static 'images/icons8-new-tab.svg' %}" width="15px" height="15px"></a>
                </div>
            </li>
         </ul>
        </li>
        {%endfor%}
    </ul>
</div>

<div class="row">
<input class="nav-link mt-3 mt-md mr-3"  type="text" placeholder="Enter scan name" name="scanName">
 <input class="nav-link  badge-warning create-new-button mt-3 mt-md"  type="submit" value="Launch scan">
</div>

</form>

<script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
<script type="text/javascript">
    $(document).ready(function() {
        $('#selectAPI').change(function() {
            var apiId = $(this).val();
            console.log(apiId);
            $.ajax({
                url: '{% url "getEndpoints" %}',  // Assurez-vous de d√©finir cette URL dans votre fichier urls.py
                data: {
                    'api_id': apiId
                },
                success: function(data) {
                    $('#endpoints-container').html(data);
                }
            });
        });
    });
</script>

<script type="text/javascript">
    document.getElementById('select-all').addEventListener('click', function() {
        var checkboxes = document.querySelectorAll('.endpoint-checkbox');
        checkboxes.forEach(function(checkbox) {
            checkbox.checked = true;
        });
    });

    document.getElementById('deselect-all').addEventListener('click', function() {
        var checkboxes = document.querySelectorAll('.endpoint-checkbox');
        checkboxes.forEach(function(checkbox) {
            checkbox.checked = false;
        });
    });
</script>
{%endblock%}