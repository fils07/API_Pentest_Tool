{% extends "collectionmanagement/base.html" %}
{%load static%}
{%block content%}
<style>
    .table td, .table select, .table input{
            background-color: inherit;
            border: none;
        }
</style>
<p class="h3">Detailed result of scan <small class="text-muted">{{scan_name}}</small> on endpoint : <small class="text-muted">{{endpoint}}</small></p>

<div class="container mt-3 mb-3">
   
  <table class="table-borderless table table-light"> 
      <tr>
        <td>Choose a security checkpoint</td>
        <td>
            <select id="my_select" class="form-select  ml-4" aria-label="Default select example">
                <option selected>Select Checkpoint</option>
                {%for checkpoint in checkpoints%}
                   <option value="{{checkpoint.id}}">{{checkpoint.Name}}</option>
                {%endfor%}
            </select>
        </td>
      </tr>

      <tr>
         <td>Status</td>
         <td>
            <select class="form-select ml-4" aria-label="Default select example" style="width:max-content;" id="conditionSelect">
                <option selected>YES</option>
                <option>NO</option>
                <option>NOT</option>
            </select>
         </td>
       </tr>
  </table>

</div>

<div class="container mt-4" id="conditionalTable">
    <table class="table table-secondary">
        <thead class="table-light text-center">
            <tr>
                <th>Confidentiality Impact</th>
                <th>Integrity Impact</th>
                <th>Availability Impact</th>
                <th>Risk score</th>
            </tr>
        </thead>
        <tbody>
            <tr>
                <td>
                    <input type="text" id="C_impact" value="2" class="text-center w-100">
                </td>
                <td>
                    <input type="text" id="I_impact" value="1" class="text-center w-100">
                </td>
                <td>
                    <input type="text" id="A_impact" value="2" class="text-center w-100">
                </td>
                <td>
                    <input type="text" id="Risk_Score" value="5" class="text-center w-100">
                </td>
            </tr>
        </tbody>
    </table>
</div>

<div class="container mt-2">
    <button class="btn btn-primary" style="width:100px;height:35px;">Save</button>
</div>


<div class="overflow-auto mt-3" style="height: 500px;">
    <div class="row">
      <div class="col-md-6  card stretch-card">
        <div class="card-body">
            <h4 class="card-title mb-1">Base Request</h4> 
              <div class="form-floating">
              <textarea id="baseRequest" name="header" style="height: 250px;width:100%;box-sizing: border-box;text-align: left;" 
              rows="10"></textarea>
            </div>
        </div>
      </div>
      
      <div class="col-md-6  card stretch-card">
        <div class="card-body">
            <h4 class="card-title mb-1">Base Response</h4> 
              <div class="form-floating">
              <textarea id="baseResponse" name="body" style="height: 250px;width:100%;box-sizing: border-box;text-align: left;" 
              rows="10"></textarea>
            </div>
        </div>
      </div>
  
    </div>

    <div class="row">
        <div class="col-md-6  card stretch-card">
          <div class="card-body">
              <h4 class="card-title mb-1">Modified Request</h4> 
                <div class="form-floating">
                <textarea id="modifiedRequest" name="header" style="height: 250px;width:100%;box-sizing: border-box;text-align: left;" 
                rows="10"></textarea>
              </div>
          </div>
        </div>
        
        <div class="col-md-6  card stretch-card">
          <div class="card-body">
              <h4 class="card-title mb-1">Modified Response</h4> 
                <div class="form-floating">
                <textarea id="modifiedResponse" name="body" style="height: 250px;width:100%;box-sizing: border-box;text-align: left;" 
                rows="10"></textarea>
              </div>
          </div>
        </div>
    
      </div>
</div>

<script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
    <script>
        $(document).ready(function() {
            $('#my_select').change(function() {
                var selectedValue = $(this).val();
                var endpoint = '{{endpoint.id}}';
                var scan_name = '{{scan_name}}'
                if (selectedValue) {
                    $.ajax({
                        url: "{% url 'get_values' %}",
                        data: {
                            'checkpoint': selectedValue,
                            'endpoint': endpoint,
                            'scan':scan_name,
                        },
                        dataType: 'json',
                        success: function(data) {
                            $('#modifiedResponse').val(data.modifiedResponse);
                            $('#modifiedRequest').val(data.modifiedRequest);
                            $('#baseRequest').val(data.baseRequest);
                            $('#baseResponse').val(data.baseResponse);
                            $('#conditionSelect').val(data.status);
                        },
                        error: function() {
                            $('#textarea-element-1').val('');
                            $('#textarea-element-2').val('');
                        }
                    });
                } else {
                    $('#textarea-element-1').val('');
                    $('#textarea-element-2').val('');
                }
            });
        });
    </script>
    <script>
        function toggleTableDisplay() {
            var table = document.getElementById('conditionalTable');
            var selectValue = document.getElementById('conditionSelect').value;
            if (selectValue === 'NO') {
                table.style.display = 'block';
            } else {
                table.style.display = 'none';
            }
        }

        document.getElementById('conditionSelect').addEventListener('change', toggleTableDisplay);

        // Call the function on page load to check the initial state of the select
        window.onload = toggleTableDisplay;
    </script>
{%endblock%}