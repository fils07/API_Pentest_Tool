from django.shortcuts import render
from collectionmanagement.views import APICollection,Endpoint
from .models import Vulnerability
# Create your views here.

def vulnHome(request):
    endpoints = dict()
    for collection in APICollection.objects.all():
        endpoints[collection.name] = Endpoint.objects.all().filter(api=collection)
    context = {
            'collections':APICollection.objects.all(),
            'endpoints':Endpoint.objects.all(),
            'vulnerability':Vulnerability.objects.all()
        }
    return render(request,'vuln_checking/vulnHome.html',context)

def getEndpoints(request):
    api_id = request.GET.get('api_id')
    print(api_id)
    if api_id:
        endpoints = Endpoint.objects.filter(api_id=api_id)
    else:
        endpoints = []

    return render(request, 'vuln_checking/endpoints.html', {'endpoints': endpoints})

def vulnDesc(request,vulnId):
    context = {
        'collections':APICollection.objects.all(),
        'endpoints':Endpoint.objects.all(),
    }
    vuln = Vulnerability.objects.filter(id=vulnId).first()
    context['vuln']=vuln
    return render(request,'vuln_checking/vulnDesc.html',context)

def checkDesc(request,checkId):
    context = {
        'collections':APICollection.objects.all(),
        'endpoints':Endpoint.objects.all(),
    }
    return render(request,'vuln_checking/checkDesc.html',context)